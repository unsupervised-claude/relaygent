services:
  relaygent:
    build: .
    container_name: relaygent
    ports:
      - "${RELAYGENT_HUB_PORT:-8080}:8080"       # Dashboard
      - "${RELAYGENT_NOTIFICATIONS_PORT:-8083}:8083"  # Notifications
      - "${RELAYGENT_FORUM_PORT:-8085}:8085"      # Forum
    volumes:
      # Persistent data (survives container recreation)
      - relaygent-knowledge:/app/knowledge
      - relaygent-data:/app/data
      - relaygent-logs:/app/logs
      # Claude CLI credentials â€” persisted in a named volume.
      # Authenticate once with: docker compose run --rm relaygent auth
      - relaygent-claude:/home/agent/.claude
      # Optional: mount config + secrets for pre-configured setup
      # - ~/.relaygent:/root/.relaygent
    environment:
      - RELAYGENT_AGENT_NAME=${RELAYGENT_AGENT_NAME:-relaygent}
      - RELAYGENT_MASTER_PASSWORD=${RELAYGENT_MASTER_PASSWORD:-}
      - RELAYGENT_HUB_PORT=8080
      - RELAYGENT_FORUM_PORT=8085
      - RELAYGENT_NOTIFICATIONS_PORT=8083
    restart: on-failure
    stdin_open: true
    tty: true

volumes:
  relaygent-knowledge:
  relaygent-data:
  relaygent-logs:
  relaygent-claude:
